<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="PZ5Shop.Views.CartView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Background="{StaticResource SurfaceBrush}" CornerRadius="14" Padding="16" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <TextBlock Text="Корзина" FontSize="20" FontWeight="SemiBold" Foreground="{StaticResource PrimaryTextBrush}" />
                    <TextBlock Text="{Binding UniqueCount, StringFormat=Уникальных товаров: {0}}" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,4,0,0" />
                </StackPanel>
                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                    <TextBlock Text="Итого" Foreground="{StaticResource SecondaryTextBrush}" />
                    <TextBlock Text="{Binding TotalAmount, StringFormat={}{0:N2} руб.}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" />
                </StackPanel>
            </Grid>
        </Border>

        <ListView Grid.Row="1" ItemsSource="{Binding Items}" Background="Transparent" BorderThickness="0" ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Background="{StaticResource CardBrush}" CornerRadius="14" Padding="12" Margin="0,0,0,10" Effect="{StaticResource CardShadow}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="140" />
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid>
                                <Border Background="{StaticResource PlaceholderBrush}" CornerRadius="8" />
                                <TextBlock Text="Нет фото" Foreground="{StaticResource SecondaryTextBrush}" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10" />
                                <Image Source="{Binding Product.ImageUrl, Converter={StaticResource ImageUrlConverter}}" Stretch="UniformToFill" />
                            </Grid>
                            <StackPanel Grid.Column="1" Margin="12,0,12,0">
                                <TextBlock Text="{Binding Product.Name}" FontWeight="SemiBold" Foreground="{StaticResource PrimaryTextBrush}" />
                                <TextBlock Text="{Binding Product.Price, StringFormat={}{0:N2} руб.}" Foreground="{StaticResource SecondaryTextBrush}" />
                            </StackPanel>
                            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Button Content="-" Width="30" Height="30" Padding="0" FontSize="16" FontWeight="SemiBold" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Command="{Binding DataContext.DecreaseCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding}" />
                                <TextBlock Text="{Binding Quantity}" Width="40" TextAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" />
                                <Button Content="+" Width="30" Height="30" Padding="0" FontSize="16" FontWeight="SemiBold" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Command="{Binding DataContext.IncreaseCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding}" />
                            </StackPanel>
                            <TextBlock Grid.Column="3" Text="{Binding TotalPrice, StringFormat={}{0:N2} руб.}" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource AccentBrush}" />
                            <Button Grid.Column="4" Content="Удалить" Margin="12,0,0,0" Command="{Binding DataContext.RemoveCommand, RelativeSource={RelativeSource AncestorType=ListView}}" CommandParameter="{Binding}" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <Button Grid.Row="2" Content="Оформить заказ" HorizontalAlignment="Right" Padding="20,10" Margin="0,12,0,0" Command="{Binding CheckoutCommand}" />
    </Grid>
</UserControl>
